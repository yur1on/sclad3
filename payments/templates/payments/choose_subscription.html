{% extends "warehouse/base.html" %}
{% load static %}
{% block title %}Выбор подписки{% endblock %}

{% block content %}
<div class="container my-4">
  <div class="row d-flex align-items-stretch">
    <!-- Левая колонка: Блок текущей подписки и выбора тарифа -->
    <div class="col-md-6 col-12 d-flex flex-column">
      <!-- Блок информации о текущей подписке -->
      <div class="card shadow-sm mb-4 flex-grow-1">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0 text-center">Ваша текущая подписка</h5>
        </div>
        <div class="card-body text-center" style="font-size:16px;">
          {% if user.profile.subscription_end and user.profile.subscription_end > now %}
            <p>Текущий тариф: <strong>{{ user.profile.get_tariff_display }}</strong><br>
               Подписка действует до: <strong>{{ user.profile.subscription_end|date:"d M Y" }}</strong>
            </p>
          {% else %}
            <p class="text-danger">Подписка отсутствует или истекла</p>
          {% endif %}
        </div>
      </div>

      <!-- Блок выбора тарифа и срока подписки -->
      <div class="card shadow-sm mb-4 flex-grow-1">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 text-center">
            {% if renew %}Продление подписки{% else %}Выберите тариф и срок подписки{% endif %}
          </h5>
        </div>
        <div class="card-body">
          {% if temporary_payment_restriction %}
            <p style="color: red; font-weight: bold; font-size: 16px; text-align: center;">
              Оплата временно недоступна. Пожалуйста, попробуйте позже.
            </p>
          {% endif %}
          <form method="post" id="subscription-form">
            {% csrf_token %}
            <!-- Предупреждение -->
            <div class="mb-4">
              {% if not renew %}
              <p style="font-size: 17px; font-weight: 600; color: red;">
                ⚠ При смене тарифа неиспользованные дни и оставшаяся сумма не компенсируются!
              </p>
              <p style="font-size:18px; font-weight:600;">Выберите тариф:</p>
              <!-- Бесплатный тариф -->
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_free" value="free"
                       {% if user.profile.tariff == 'free' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_free">Бесплатный (до 30 запчастей)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Бесплатный" data-tariff-cost="0 руб"
                   data-tariff-limits="- На склад можно добавить до 30 запчастей.<br>- Для каждой запчасти допустимо загрузить только одно фото.<br>- Отправка уведомлений возможна не чаще одного раза в 24 часа."
                   data-tariff-description="Подходит для тех, кто разобрал своё устройство и хочет продать его запчасти.">Подробнее</a>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_lite" value="lite"
                       {% if user.profile.tariff == 'lite' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_lite">Базовый (до 500 запчастей)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Базовый" data-tariff-cost="20 руб/30 дней"
                   data-tariff-limits="Добавить на склад можно до 500 запчастей."
                   data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей.">Подробнее</a>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_standard" value="standard"
                       {% if user.profile.tariff == 'standard' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_standard">Стандартный (до 2000 запчастей)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Стандартный" data-tariff-cost="40 руб/30 дней"
                   data-tariff-limits="Добавить на склад можно до 2000 запчастей."
                   data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей.">Подробнее</a>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_standard2" value="standard2"
                       {% if user.profile.tariff == 'standard2' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_standard2">Продвинутый (до 7000 запчастей)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Продвинутый" data-tariff-cost="70 руб/30 дней"
                   data-tariff-limits="Добавить на склад можно до 7000 запчастей."
                   data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей.">Подробнее</a>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_standard3" value="standard3"
                       {% if user.profile.tariff == 'standard3' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_standard3">Профессиональный (до 15000 запч.)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Профессиональный" data-tariff-cost="120 руб/30 дней"
                   data-tariff-limits="Добавить на склад можно до 15000 запчастей."
                   data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей.">Подробнее</a>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="tariff_type" id="tariff_premium" value="premium"
                       {% if user.profile.tariff == 'premium' %}checked{% endif %}>
                <label class="form-check-label" for="tariff_premium">Неограниченный (без ограничений)</label>
                <a href="#" class="tariff-details ms-2" data-bs-toggle="modal" data-bs-target="#tariffModal"
                   data-tariff-name="Неограниченный" data-tariff-cost="300 руб/30 дней"
                   data-tariff-limits="Без лимита"
                   data-tariff-description="Для максимальной активности.">Подробнее</a>
              </div>
              {% else %}
              <p style="font-size:18px; font-weight:600;">Продлите ваш тариф: {{ user.profile.get_tariff_display }}</p>
              <input type="hidden" name="tariff_type" value="{{ user.profile.tariff }}">
              {% endif %}
            </div>

            <!-- Блоки для выбора срока подписки -->
            <div id="duration_free" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'free' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'free' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Тариф Бесплатный не требует оплаты</p>
            </div>

            <div id="duration_lite" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'lite' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'lite' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Выберите срок подписки для тарифа Базовый:</p>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_lite_1" value="1" checked>
                <label class="form-check-label" for="duration_lite_1">30 дней – 20 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_lite_3" value="3">
                <label class="form-check-label" for="duration_lite_3">90 дней – 60 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_lite_6" value="6">
                <label class="form-check-label" for="duration_lite_6">180 дней – 120 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_lite_12" value="12">
                <label class="form-check-label" for="duration_lite_12">360 дней – 240 руб</label>
              </div>
            </div>

            <div id="duration_standard" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'standard' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'standard' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Выберите срок подписки для тарифа Стандартный:</p>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard_1" value="1" checked>
                <label class="form-check-label" for="duration_standard_1">30 дней – 40 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard_3" value="3">
                <label class="form-check-label" for="duration_standard_3">90 дней – 120 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard_6" value="6">
                <label class="form-check-label" for="duration_standard_6">180 дней – 240 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard_12" value="12">
                <label class="form-check-label" for="duration_standard_12">360 дней – 480 руб</label>
              </div>
            </div>

            <div id="duration_standard2" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'standard2' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'standard2' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Выберите срок подписки для тарифа Продвинутый:</p>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard2_1" value="1" checked>
                <label class="form-check-label" for="duration_standard2_1">30 дней – 70 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard2_3" value="3">
                <label class="form-check-label" for="duration_standard2_3">90 дней – 210 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard2_6" value="6">
                <label class="form-check-label" for="duration_standard2_6">180 дней – 420 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard2_12" value="12">
                <label class="form-check-label" for="duration_standard2_12">360 дней – 840 руб</label>
              </div>
            </div>

            <div id="duration_standard3" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'standard3' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'standard3' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Выберите срок подписки для тарифа Профессиональный:</p>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard3_1" value="1" checked>
                <label class="form-check-label" for="duration_standard3_1">30 дней – 120 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard3_3" value="3">
                <label class="form-check-label" for="duration_standard3_3">90 дней – 360 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard3_6" value="6">
                <label class="form-check-label" for="duration_standard3_6">180 дней – 720 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_standard3_12" value="12">
                <label class="form-check-label" for="duration_standard3_12">360 дней – 1440 руб</label>
              </div>
            </div>

            <div id="duration_premium" class="duration-block mb-4" style="{% if renew %}{% if user.profile.tariff == 'premium' %}display:block;{% else %}display:none;{% endif %}{% else %}{% if user.profile.tariff == 'premium' %}display:block;{% else %}display:none;{% endif %}{% endif %}">
              <p style="font-size:18px; font-weight:600;">Выберите срок подписки для тарифа Неограниченный:</p>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_premium_1" value="1" checked>
                <label class="form-check-label" for="duration_premium_1">30 дней – 300 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_premium_3" value="3">
                <label class="form-check-label" for="duration_premium_3">90 дней – 900 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_premium_6" value="6">
                <label class="form-check-label" for="duration_premium_6">180 дней – 1800 руб</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" name="duration" id="duration_premium_12" value="12">
                <label class="form-check-label" for="duration_premium_12">360 дней – 3600 руб</label>
              </div>
            </div>

            <!-- Блок предварительного расчёта итоговой подписки -->
            <div id="subscription-info" class="mb-4" style="font-size:16px; text-align:center;"></div>

            <!-- Кнопка действия -->
            <div class="text-center" id="action-buttons">
              {% if temporary_payment_restriction %}
                <p style="color: red; font-weight: bold; font-size: 16px;">
                  Оплата временно недоступна. Пожалуйста, попробуйте позже.
                </p>
              {% else %}
                <button type="submit" class="btn btn-success btn-lg" id="payment-button">Перейти к оплате</button>
              {% endif %}
            </div>
          </form>
          <div class="mt-3 text-center">
            <a href="{% url 'profile' %}" class="btn btn-secondary">Вернуться в профиль</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Правая колонка: блок "Условия тарифов" (только для десктопа) -->
    <div class="col-md-6 col-12 d-flex flex-column d-none d-md-flex">
      <div class="tariff-table-container card shadow-sm flex-grow-1">
        <div class="card-body">
          <h5>Условия тарифов и ограничения</h5>
          <p>Нажмите на тариф, чтобы увидеть подробности. <a href="{% url 'about_project' %}#tariffs"> Тарифы</a></p>

          <table class="tariff-table">
            <thead>
              <tr>
                <th>Тариф</th>
                <th>Стоимость</th>
                <th>Лимиты</th>
              </tr>
            </thead>
            <tbody>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Бесплатный"
                  data-tariff-cost="0 руб"
                  data-tariff-limits="- На склад можно добавить до 30 запчастей.<br>- Для каждой запчасти допустимо загрузить только одно фото.<br>- Отправка уведомлений возможна не чаще одного раза в 24 часа."
                  data-tariff-description="Подходит для тех, кто разобрал своё устройство и хочет продать его запчасти."
                  {% if user.profile.tariff == 'free' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-gift"></i> Бесплатный</td>
                <td>0 руб</td>
                <td>До 30<br>1 фото</td>
              </tr>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Базовый"
                  data-tariff-cost="20 руб/30 дней"
                  data-tariff-limits="Добавить на склад можно до 500 запчастей."
                  data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей."
                  {% if user.profile.tariff == 'lite' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-lightbulb"></i> Базовый</td>
                <td>20 руб/30 дней</td>
                <td>До 500</td>
              </tr>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Стандартный"
                  data-tariff-cost="40 руб/30 дней"
                  data-tariff-limits="Добавить на склад можно до 2000 запчастей."
                  data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей."
                  {% if user.profile.tariff == 'standard' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-wrench"></i> Стандартный</td>
                <td>40 руб/30 дней Lattice
                <td>До 2000</td>
              </tr>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Продвинутый"
                  data-tariff-cost="70 руб/30 дней"
                  data-tariff-limits="Добавить на склад можно до 7000 запчастей."
                  data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей."
                  {% if user.profile.tariff == 'standard2' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-tools"></i> Продвинутый</td>
                <td>70 руб/30 дней</td>
                <td>До 7000</td>
              </tr>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Профессиональный"
                  data-tariff-cost="120 руб/30 дней"
                  data-tariff-limits="Добавить на склад можно до 15000 запчастей."
                  data-tariff-description="После окончания подписки в поиске видны 30 последних запчастей."
                  {% if user.profile.tariff == 'standard3' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-microchip"></i> Профессиональный</td>
                <td>120 руб/30 дней</td>
                <td>До 15000</td>
              </tr>
              <tr data-bs-toggle="modal" data-bs-target="#tariffModal"
                  data-tariff-name="Неограниченный"
                  data-tariff-cost="300 руб/30 дней"
                  data-tariff-limits="Без лимита"
                  data-tariff-description="Для максимальной активности."
                  {% if user.profile.tariff == 'premium' %}class="active-tariff"{% endif %}>
                <td><i class="fas fa-infinity"></i> Неограниченный</td>
                <td>300 руб/30 дней</td>
                <td>Без лимита</td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3">* При окончании подписки в поиске видны только 30 запчастей.</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно для подробностей тарифа -->
<div class="modal fade" id="tariffModal" tabindex="-1" aria-labelledby="tariffModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content custom-modal">
      <div class="modal-header">
        <h5 class="modal-title" id="tariffModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
      </div>
      <div class="modal-body">
        <table class="table">
          <tbody>
            <tr>
              <th>Стоимость</th>
              <td id="tariffCost"></td>
            </tr>
            <tr>
              <th>Лимиты</th>
              <td id="tariffLimits"></td>
            </tr>
            <tr>
              <th>Описание</th>
              <td id="tariffDescription"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<span id="current-end" data-current-end="{% if user.profile.subscription_end and user.profile.subscription_end > now %}{{ user.profile.subscription_end|date:"c" }}{% else %}{{ now|date:"c" }}{% endif %}" style="display:none;"></span>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const tariffRadios = document.getElementsByName("tariff_type");
    const durationFree = document.getElementById("duration_free");
    const durationLite = document.getElementById("duration_lite");
    const durationStandard = document.getElementById("duration_standard");
    const durationStandard2 = document.getElementById("duration_standard2");
    const durationStandard3 = document.getElementById("duration_standard3");
    const durationPremium = document.getElementById("duration_premium");
    const subscriptionInfo = document.getElementById("subscription-info");
    const paymentButton = document.getElementById("payment-button");
    const temporaryRestriction = {{ temporary_payment_restriction|yesno:"true,false" }};
    const currentEndStr = document.getElementById("current-end").dataset.currentEnd;
    const currentEndDate = new Date(currentEndStr);
    const now = new Date();

    // Отключение кнопки оплаты, если активен флаг ограничения
    if (temporaryRestriction && paymentButton) {
        paymentButton.disabled = true;
        paymentButton.style.opacity = "0.6";
        paymentButton.style.cursor = "not-allowed";
    }

    function addDays(date, days) {
        let d = new Date(date);
        d.setDate(d.getDate() + days);
        return d;
    }

    function formatDate(date) {
        let dd = date.getDate();
        let mm = date.getMonth() + 1;
        let yyyy = date.getFullYear();
        if (dd < 10) dd = '0' + dd;
        if (mm < 10) mm = '0' + mm;
        return dd + '.' + mm + '.' + yyyy;
    }

    function updateSubscriptionInfo() {
        const selectedTariff = document.querySelector('input[name="tariff_type"]:checked') ?
                              document.querySelector('input[name="tariff_type"]:checked').value : '{{ user.profile.tariff }}';
        const selectedDuration = document.querySelector('input[name="duration"]:checked') ?
                                 parseInt(document.querySelector('input[name="duration"]:checked').value) : 1;
        let baseDate = (currentEndDate > now && selectedTariff === '{{ user.profile.tariff }}') ? currentEndDate : now;
        let newEndDate = addDays(baseDate, 30 * selectedDuration);
        if (selectedTariff === 'free') {
            subscriptionInfo.innerHTML = `<p>Тариф "Бесплатный" активен по умолчанию и не требует оплаты.</p>`;
            if (paymentButton) {
                paymentButton.textContent = "Активировать";
                paymentButton.disabled = false;
                paymentButton.style.opacity = "1";
                paymentButton.style.cursor = "pointer";
            }
        } else {
            subscriptionInfo.innerHTML = `<p>При выбранном варианте ваша подписка будет действовать до <strong>${formatDate(newEndDate)}</strong></p>`;
            if (paymentButton && !temporaryRestriction) {
                paymentButton.textContent = "Перейти к оплате";
                paymentButton.disabled = false;
                paymentButton.style.opacity = "1";
                paymentButton.style.cursor = "pointer";
            }
        }
    }

    {% if not renew %}
    function toggleDurationBlocks() {
        const selectedTariff = document.querySelector('input[name="tariff_type"]:checked').value;
        durationFree.style.display = selectedTariff === "free" ? "block" : "none";
        durationLite.style.display = selectedTariff === "lite" ? "block" : "none";
        durationStandard.style.display = selectedTariff === "standard" ? "block" : "none";
        durationStandard2.style.display = selectedTariff === "standard2" ? "block" : "none";
        durationStandard3.style.display = selectedTariff === "standard3" ? "block" : "none";
        durationPremium.style.display = selectedTariff === "premium" ? "block" : "none";

        let activeBlock = document.querySelector(`#duration_${selectedTariff}`);
        if (activeBlock) {
            let firstDuration = activeBlock.querySelector('input[name="duration"]');
            if (firstDuration) firstDuration.checked = true;
        }
        updateSubscriptionInfo();
    }

    tariffRadios.forEach(function(radio) {
        radio.addEventListener("change", toggleDurationBlocks);
    });
    {% endif %}

    const durationRadios = document.getElementsByName("duration");
    durationRadios.forEach(function(radio) {
        radio.addEventListener("change", updateSubscriptionInfo);
    });

    {% if not renew %}
    toggleDurationBlocks();
    {% else %}
    updateSubscriptionInfo();
    {% endif %}

    // Скрипт для модального окна
    var tariffModal = document.getElementById('tariffModal');
    tariffModal.addEventListener('show.bs.modal', function (event) {
      var trigger = event.relatedTarget;
      var tariffName = trigger.getAttribute('data-tariff-name');
      var tariffCost = trigger.getAttribute('data-tariff-cost');
      var tariffLimits = trigger.getAttribute('data-tariff-limits');
      var tariffDescription = trigger.getAttribute('data-tariff-description');

      var modalTitle = tariffModal.querySelector('.modal-title');
      var modalCost = tariffModal.querySelector('#tariffCost');
      var modalLimits = tariffModal.querySelector('#tariffLimits');
      var modalDescription = tariffModal.querySelector('#tariffDescription');

      modalTitle.textContent = tariffName || "Неизвестный тариф";
      modalCost.textContent = tariffCost || "Не указано";
      modalLimits.innerHTML = tariffLimits || "Не указано";
      modalDescription.textContent = tariffDescription || "Нет описания";
    });
});
</script>

<style>
  .card {
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .card-header {
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }
  .card-body {
    flex-grow: 1;
  }
  .duration-block {
    background-color: #f8f9fa;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 10px;
    margin  margin-bottom: 15px;
  }
  .tariff-table-container {
    margin-top: 0;
    margin-bottom: 0;
    background-color: #f8f9fa;
    padding: 20px;
    border: 1px solid #dee2e6;
    border-radius: 10px;
  }
  .tariff-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 16px;
    border-radius: 10px;
    overflow: hidden;
  }
  .tariff-table th, .tariff-table td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #dee2e6;
  }
  .tariff-table th {
    background-color: #007bff;
    color: white;
    font-weight: 600;
  }
  .tariff-table td {
    background-color: #fff;
  }
  .tariff-table tr.active-tariff td {
    background-color: #d4edda;
    color: #155724;
  }
  .tariff-table tbody tr:hover {
    transform: scale(1.02);
    background-color: #e9ecef;
    cursor: pointer;
  }
  .tariff-table i {
    margin-right: 5px;
    color: #007bff;
  }
  .tariff-table tr.active-tariff i {
    color: #155724;
  }
  .row.d-flex {
    display: flex;
    flex-wrap: wrap;
  }
  .col-md-6.d-flex, .col-12.d-flex {
    display: flex;
    flex-direction: column;
  }
  .flex-grow-1 {
    flex-grow: 1;
  }
  .custom-modal {
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
  }
  .custom-modal .modal-header {
    border-bottom: none;
    background-color: #f1f1f1;
    padding: 1rem;
    border-radius: 15px 15px 0 0;
  }
  .custom-modal .modal-body {
    padding: 1.5rem;
  }
  .tariff-details {
    font-size: 0.9rem;
    color: #007bff;
    text-decoration: none;
  }
  .tariff-details:hover {
    text-decoration: underline;
  }
  .form-check {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  /* Медиа-запросы для мобильных устройств */
  @media (max-width: 767px) {
    .container {
      margin: 0.5rem 0;
      padding: 0 0.5rem;
    }
    .row {
      flex-direction: column;
      gap: 0.5rem;
    }
    .col-md-6, .col-12 {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    .card-body {
      padding: 0.75rem;
    }
    .form-check {
      font-size: 0.85rem;
    }
    .duration-block {
      padding: 0.75rem;
    }
    .btn {
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
    }
    .btn-lg {
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }
    h5 {
      font-size: 1rem;
    }
    p {
      font-size: 0.85rem;
    }
    .tariff-details {
      font-size: 0.75rem;
    }
    .modal-dialog {
      margin: 0.5rem;
    }
    .modal-body {
      padding: 0.75rem;
    }
    .modal-title {
      font-size: 1rem;
    }
    .table th, .table td {
      font-size: 0.85rem;
    }
    .card-body[style*="font-size:16px"] {
      font-size: 0.85rem !important;
    }
    p[style*="font-size: 17px"] {
      font-size: 0.9rem !important;
    }
    p[style*="font-size:18px"] {
      font-size: 1rem !important;
    }
    #subscription-info[style*="font-size:16px"] {
      font-size: 0.85rem !important;
    }
  }
</style>

{% endblock %}