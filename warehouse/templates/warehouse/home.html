{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}Главная{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
  :root{
    --primary:#007bff;
    --dark:#212529;
    --radius:14px;
    --transition:all .3s ease;
    --table-max:1600px;
  }

  html,body{max-width:100%; overflow-x:hidden;}
  body{font-family:'Roboto',sans-serif;margin:0;padding:0;}

  .hero{padding:1.6rem 1rem;text-align:center}
  .hero h1{font-size:1.7rem;font-weight:700;margin:0 0 .35rem;line-height:1.2;color:#1a1a1a}
  .hero p{font-size:.9rem;opacity:.92;margin:0 0 .9rem;line-height:1.4;color:#555}
  .btn-warehouse{
    background:var(--primary);color:#fff;border:none;border-radius:var(--radius);
    padding:.55rem 1.1rem;font-size:.84rem;font-weight:500;
    box-shadow:0 3px 10px rgba(0,123,255,.3);
    display:inline-flex;align-items:center;gap:.4rem;transition:var(--transition)
  }
  .btn-warehouse:hover{background:#0056b3;transform:translateY(-1px);box-shadow:0 5px 14px rgba(0,123,255,.4)}

  .content-grid{display:grid;gap:.9rem;padding:0 .5rem}

  .how-it-works{padding:0 1rem;font-size:.8rem;line-height:1.48;color:#444}
  .how-it-works ul{list-style:none;padding:0;margin:0 0 1rem;display:grid;grid-template-columns:1fr;gap:.7rem}
  .how-it-works li{display:flex;align-items:flex-start;gap:.6rem}
  .how-it-works i{font-size:1.1rem;color:var(--primary);flex-shrink:0;margin-top:.12rem}
  .how-it-works strong{display:block;font-size:.86rem;color:var(--dark);margin-bottom:.05rem}
  .how-it-works a{color:var(--primary);text-decoration:underline}

  .search-bar{max-width:100%;padding:0 1rem}
  .form-control{
    border-radius:var(--radius);padding:.62rem .9rem;font-size:.92rem;
    border:1px solid #e0e4e8;box-shadow:0 2px 6px rgba(0,0,0,.04);transition:var(--transition);width:100%
  }
  .form-control:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,123,255,.16)}
  .btn-search{
    background:var(--dark);color:#fff;border:none;border-radius:var(--radius);
    padding:.62rem 1.2rem;font-weight:600;font-size:.9rem;white-space:nowrap;flex-shrink:0;
    transition:var(--transition);box-shadow:0 2px 6px rgba(0,0,0,.1)
  }
  .btn-search:hover{background:#000;transform:translateY(-1px);box-shadow:0 4px 10px rgba(0,0,0,.15)}
  .search-form .d-flex{gap:.6rem;flex-wrap:nowrap}
  .search-form{margin-bottom:1.8rem}

  .home-table{width:100%;padding:0 8px 24px}
  .home-table__inner{width:100%;max-width:var(--table-max);margin:0 auto}
  .home-table__inner .col-md-9{flex:0 0 100%;max-width:100%}
  .home-table__inner .col-md-3{display:none!important}

  .fade-in{opacity:0;transform:translateY(20px);transition:opacity .6s ease,transform .6s ease;}
  .fade-in.visible{opacity:1;transform:translateY(0)}

  .scroll-to-top{
    position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:var(--primary);
    color:#fff;border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;
    cursor:pointer;opacity:0;visibility:hidden;transition:all .3s ease;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:99
  }
  .scroll-to-top.visible{opacity:1;visibility:visible}
  .scroll-to-top:hover{background:#0056b3;transform:translateY(-3px)}

  @media (max-width: 768px){
    .search-form .d-flex{flex-direction:column}
    .btn-search{width:100%}

    /* СКРЫВАЕМ ИНФО-БЛОК (от "Создайте свой склад" до "Помогайте друг другу") */
    .how-steps { display: none !important; }
  }

  @media (min-width: 577px){
    .how-it-works ul{grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
    .search-form .d-flex{flex-direction:row}
  }
</style>

<div class="container-fluid px-0">
  <!-- HERO -->
  <div class="hero fade-in">
    <h1>Разбирай, сохраняй, находи на MobiRazbor.by!</h1>
    <p>Управляйте своим складом и находите запчасти легко и быстро.</p>
    <a href="{% url 'warehouse' %}" class="btn btn-warehouse">Мой склад</a>
  </div>

  <!-- Информация + Поиск -->
  <div class="container content-grid">
    <div class="how-it-works fade-in">

      {# Этот блок скрываем на мобильной версии #}
      <div class="how-steps">
        <ul>
          <li><i class="bi bi-box-seam"></i><div><strong>Создайте свой склад</strong><br>Зарегистрируйтесь и заполните свой профиль.</div></li>
          <li><i class="bi bi-wrench"></i><div><strong>Добавляйте запчасти</strong><br>Разбирайте ненужные устройства и добавляйте запчасти на свой склад.</div></li>
          <li><i class="bi bi-search"></i><div><strong>Ищите нужную запчасть</strong><br>Нужна запчасть? Используйте <a href="{% url 'search' %}">глобальный поиск</a>.</div></li>
          <li><i class="bi bi-chat-dots"></i><div><strong>Свяжитесь с продавцом</strong><br>Нашли запчасть? Договоритесь о покупке напрямую с владельцем.</div></li>
          <li><i class="bi bi-hand-thumbs-up"></i><div><strong>Помогайте друг другу</strong><br>Даже самая мелкая запчасть у вас может кому-то пригодиться.</div></li>
        </ul>
      </div>

      <!-- Форма: переходит на глобальный поиск -->
      <form method="GET" action="{% url 'search' %}" class="search-bar search-form">
        <div class="d-flex">
          <input type="text"
                 name="q"
                 class="form-control"
                 placeholder="iPhone 13 камера, Samsung динамик..."
                 value="{{ query|default:'' }}"
                 autocomplete="off">
          <button type="submit" class="btn btn-search">Поиск</button>
        </div>
      </form>

    </div>
  </div>

  <!-- На главной можно показывать последние добавления (по желанию) -->
  <section class="home-table">
    <div class="home-table__inner">
      {% include 'warehouse/search_table.html' %}
    </div>
  </section>
</div>

<button class="scroll-to-top" id="scrollToTop">
  <i class="bi bi-chevron-up"></i>
</button>

<script>
  // Только анимации и кнопка вверх — НЕТ перехвата submit!
  document.addEventListener('DOMContentLoaded', () => {
    const scrollToTop = document.getElementById('scrollToTop');
    const fadeElements = document.querySelectorAll('.fade-in');

    const handleScrollAnimation = () => {
      fadeElements.forEach(el => {
        const top = el.getBoundingClientRect().top;
        if (top < window.innerHeight - 100) el.classList.add('visible');
      });
    };

    const handleScrollToTop = () => {
      if (window.pageYOffset > 300) scrollToTop.classList.add('visible');
      else scrollToTop.classList.remove('visible');
    };

    scrollToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    handleScrollAnimation();
    handleScrollToTop();
    window.addEventListener('scroll', () => {
      handleScrollAnimation();
      handleScrollToTop();
    });
  });
</script>
{% endblock %}
