{# templates/warehouse/search_table.html #}
{# –í–∞—Ä–∏–∞–Ω—Ç (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π): —É–±—Ä–∞–Ω—ã ‚ú® –≤–æ–∑–ª–µ —Ü–µ–Ω—ã (–±–µ–π–¥–∂) –∏ —à—Ç—Ä–∏—Ö–æ–≤–∫–∞ #}

<style>
  .results-container { padding-left: .5rem; padding-right: .5rem; }

  .result-card{
    position: relative;
    border-radius: 18px;
    margin-bottom: 12px;
    cursor: pointer;

    border: 1.5px solid transparent;
    background:
      linear-gradient(135deg, #f7f9fc 0%, #ffffff 60%, #f3f6ff 100%) padding-box,
      linear-gradient(135deg, rgba(37,99,235,.55), rgba(34,197,94,.45), rgba(99,102,241,.45)) border-box;

    box-shadow: 0 10px 22px rgba(15,23,42,.08);
    transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
    overflow: hidden;
  }

  /* —É–±—Ä–∞–ª–∏ —à—Ç—Ä–∏—Ö–æ–≤–∫—É: –æ—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ –º—è–≥–∫–∏–µ –ø—è—Ç–Ω–∞ */
  .result-card::before{
    content:"";
    position:absolute;
    inset:0;
    background:
      radial-gradient(900px 240px at 10% -10%, rgba(37,99,235,.12), transparent 60%),
      radial-gradient(760px 240px at 110% 0%, rgba(34,197,94,.10), transparent 55%);
    opacity:.75;
    pointer-events:none;
  }

  /* —É–±—Ä–∞–ª–∏ ‚Äú–∑–≤—ë–∑–¥–æ—á–∫—É/–±–µ–π–¥–∂‚Äù */
  .result-card::after{ content:none; }

  .result-card:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 34px rgba(15,23,42,.14);
    filter: saturate(1.03);
  }

  .result-header-mobile{
    display:none;
    padding:8px 12px;
    border-bottom: 1px solid rgba(148,163,184,.25);
    position:relative;
    z-index:1;
  }
  .result-header-mobile-inner{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .result-title-mobile{
    font-size:17px; font-weight:600; color:#111827;
    flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .result-price-mobile{ font-size:17px; font-weight:600; color:#16a34a; white-space:nowrap; }

  .result-body{
    display:flex;
    gap:10px;
    padding:10px 14px 12px;
    position:relative;
    z-index:1;
  }

  .result-image-col{ flex:0 0 80px; display:flex; align-items:center; justify-content:center; }
  .result-main-col{ flex:1; min-width:0; }

  .result-seller-col, .result-city-col, .result-price-col{
    display:none;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  .result-seller-col, .result-city-col{
    font-size:15px;
    font-weight:400;
    color:inherit;
  }

  .result-price-col{
    font-weight:800;
    color:#16a34a;
    text-shadow: 0 10px 24px rgba(34,197,94,.20);
  }

  .result-title-desktop{ font-size:17px; font-weight:600; color:#111827; margin-bottom:2px; }
  .result-device-line{ font-size:14px; color:#111827; margin-bottom:2px; }
  .result-condition{ font-size:13px; color:#6b7280; margin-bottom:0; }

  .result-seller-city-mobile{ font-size:13px; color:#4b5563; }
  .result-seller-city-mobile div{ margin-bottom:2px; }
  .result-seller-city-mobile strong{ font-weight:600; }

  .image-container{
    width:80px; height:80px; position:relative;
    display:flex; align-items:center; justify-content:center;
    border-radius:14px; overflow:hidden;

    background: rgba(229,237,247,.85);
    box-shadow: 0 12px 26px rgba(15,23,42,.10);
  }
  .image-container::after{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(135deg, rgba(255,255,255,.55), rgba(255,255,255,0) 45%);
    pointer-events:none;
    opacity:.9;
  }
  .img-thumbnail{ width:100%; height:100%; object-fit:cover; border:none; border-radius:14px; display:block; }

  .extra-images{
    position:absolute; bottom:6px; right:6px;
    background: rgba(15,23,42,.78);
    color:#fff;
    padding:2px 8px;
    border-radius:999px;
    font-size:11px;
    backdrop-filter: blur(8px);
  }
  .no-image-text{
    font-size:13px; color:#6b7280;
    width:100%; height:100%;
    display:flex; align-items:center; justify-content:center;
    background-color:#e5edf7;
    border-radius:14px;
    padding:4px;
  }

  .results-empty{ text-align:center; padding:2rem 0; color:#6b7280; }

  @media (max-width:768px){
    .result-card{ border-radius:16px; margin-bottom:10px; }
    .result-header-mobile{ display:block; }
    .result-title-desktop, .result-seller-col, .result-city-col, .result-price-col{ display:none; }
  }

  @media (min-width:769px){
    .result-header-mobile{ display:none; }

    .result-body{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      column-gap:14px;
      padding:12px 18px;
      align-items:center;
      justify-items:stretch;
    }

    .result-image-col{ grid-column:1; justify-self:start; justify-content:flex-start; align-items:flex-start; }
    .result-main-col { grid-column:2; justify-self:start; text-align:left; }

    .result-seller-col, .result-city-col, .result-price-col{ display:block; }

    .result-seller-col{ grid-column:3; }
    .result-city-col  { grid-column:4; }
    .result-price-col { grid-column:5; justify-self:end; text-align:right; font-size:19px; overflow:visible; text-overflow:clip; }

    .result-seller-col, .result-city-col{
      justify-self:center;
      text-align:center;
      position:relative;
      padding-top:18px;
    }

    .result-seller-col::before{ content:"üë§ –ü—Ä–æ–¥–∞–≤–µ—Ü"; }
    .result-city-col::before  { content:"üìç –ì–æ—Ä–æ–¥"; }

    .result-seller-col::before,
    .result-city-col::before{
      position:absolute; top:0; left:0; width:100%;
      text-align:center;
      font-size:11px; font-weight:600;
      color: rgba(17,24,39,.40);
      letter-spacing:.02em;
      pointer-events:none;
    }

    .result-seller-city-mobile{ display:none; }
  }

  @media (max-width:576px){
    .results-container{ padding-left:8px; padding-right:8px; }
  }

  .pagination{ flex-wrap:wrap; gap:.25rem; }
  .page-link{
    padding:.4rem .7rem;
    font-size:.95rem;
    min-width:2.25rem;
    text-align:center;
    border-radius:999px !important;
  }
  .page-item.active .page-link{ background-color:#2563eb; border-color:#2563eb; }
  .page-item .page-link{ border-color: rgba(148,163,184,.7); color:#1f2933; }
  .page-item.disabled .page-link{ color:#9ca3af; }
</style>

<div class="container results-container">

  {% if page_obj %}
    {% for result in page_obj %}
      <div class="result-card"
           onclick="window.location.href='{% url 'part_detail' result.id %}'">

        <div class="result-header-mobile">
          <div class="result-header-mobile-inner">
            <div class="result-title-mobile">{{ result.part_type }}</div>
            <div class="result-price-mobile">{{ result.price|floatformat:0 }} BYN</div>
          </div>
        </div>

        <div class="result-body">

          <div class="result-image-col">
            <div class="image-container">
              {# –í Django template if –ø–æ related manager –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ .exists #}
              {% if result.images.exists %}
                <img src="{{ result.images.first.image.url }}"
                     alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏"
                     class="img-thumbnail">
                {% if result.images.count > 1 %}
                  <div class="extra-images">
                    +{{ result.images.count|add:"-1" }} –µ—â—ë
                  </div>
                {% endif %}
              {% else %}
                <span class="no-image-text">–ù–µ—Ç —Ñ–æ—Ç–æ</span>
              {% endif %}
            </div>
          </div>

          <div class="result-main-col">
            <div class="result-title-desktop">{{ result.part_type }}</div>
            <div class="result-device-line">{{ result.device }} {{ result.brand }} {{ result.display_model }}</div>
            {% if result.condition %}
              <div class="result-condition"><strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> {{ result.condition }}</div>
            {% endif %}

            <div class="result-seller-city-mobile">
              <div><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> {{ result.user.profile.workshop_name|default:"–ß–∞—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ" }}</div>
              <div><strong>–ì–æ—Ä–æ–¥:</strong> {{ result.user.profile.city }}</div>
            </div>
          </div>

          <div class="result-seller-col">
            {{ result.user.profile.workshop_name|default:"–ß–∞—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ" }}
          </div>

          <div class="result-city-col">
            {{ result.user.profile.city }}
          </div>

          <div class="result-price-col">
            {{ result.price|floatformat:0 }} BYN
          </div>

        </div>
      </div>

    {% empty %}
      <div class="results-empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>
    {% endfor %}
  {% else %}
    <div class="results-empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>
  {% endif %}

  {# –ü–ê–ì–ò–ù–ê–¶–ò–Ø –ë–ï–ó –°–ö–û–ë–û–ö –í IF #}
  {% if page_obj %}
    {% if page_obj.has_previous or page_obj.has_next %}
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center my-3">

          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?{{ base_qs }}&page=1" aria-label="First">¬´</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?{{ base_qs }}&page={{ page_obj.previous_page_number }}" aria-label="Previous">‚Äπ</a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
              {% if num == page_obj.number %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% else %}
                <li class="page-item">
                  <a class="page-link" href="?{{ base_qs }}&page={{ num }}">{{ num }}</a>
                </li>
              {% endif %}
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?{{ base_qs }}&page={{ page_obj.next_page_number }}" aria-label="Next">‚Ä∫</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?{{ base_qs }}&page={{ page_obj.paginator.num_pages }}" aria-label="Last">¬ª</a>
            </li>
          {% endif %}

        </ul>
      </nav>
    {% endif %}
  {% endif %}

</div>
