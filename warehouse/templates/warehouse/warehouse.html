{% extends 'warehouse/base.html' %}
{% block title %}–°–∫–ª–∞–¥{% endblock %}
{% block content %}
{% load static %}
    <div class="d-flex flex-column align-items-start mb-4">
        <div class="d-flex justify-content-between align-items-center w-100 mb-4">
            <h2 class="mb-0">–í–∞—à–∏ –∑–∞–ø—á–∞—Å—Ç–∏</h2>
            <div class="d-flex">
                <a href="{% url 'add_part' %}" class="btn btn-success mr-2">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</a>
                <a href="{% url 'export_excel' %}" class="btn btn-info">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
    <div class="mb-4">
        <form method="get" class="form-row">
            <!-- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ -->
            <div class="form-group col-md-3">
                <label for="device">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label>
                <div class="input-group">
                    <input type="text" list="devices" name="q" id="device" class="form-control" placeholder="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" value="{{ query|default_if_none:'' }}">
                    <datalist id="devices">
                        <option value="–¢–µ–ª–µ—Ñ–æ–Ω">
                        <option value="–ü–ª–∞–Ω—à–µ—Ç">
                        <option value="–ù–æ—É—Ç–±—É–∫">
                        <option value="–°–º–∞—Ä—Ç-—á–∞—Å—ã">
                    </datalist>
                </div>
            </div>

            <!-- –ë—Ä–µ–Ω–¥ -->
            <div class="form-group col-md-2">
                <label for="brand">–ë—Ä–µ–Ω–¥</label>
                <div class="input-group">
                    <input list="brands" name="brand" id="brand" class="form-control" placeholder="–ë—Ä–µ–Ω–¥" value="{{ brand|default_if_none:'' }}">
                    <datalist id="brands">
                        <!-- –ë—Ä–µ–Ω–¥—ã –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </datalist>
                </div>
            </div>

            <!-- –ú–æ–¥–µ–ª—å -->
            <div class="form-group col-md-2">
                <label for="model">–ú–æ–¥–µ–ª—å</label>
                <div class="input-group">
                    <input list="models" name="model" id="model" class="form-control" placeholder="–ú–æ–¥–µ–ª—å" value="{{ model|default_if_none:'' }}">
                    <datalist id="models">
                        <!-- –ú–æ–¥–µ–ª–∏ –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </datalist>
                </div>
            </div>

            <!-- –¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏ -->
            <div class="form-group col-md-3">
                <label for="part_type">–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</label>
                <div class="input-group">
                    <input list="part_types" name="part_type" id="part_type" class="form-control" placeholder="–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏" value="{{ part_type|default_if_none:'' }}">
                    <datalist id="part_types">
                        <!-- –¢–∏–ø—ã –∑–∞–ø—á–∞—Å—Ç–µ–π –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
                    </datalist>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
            <div class="form-group col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary btn-block">–ü–æ–∏—Å–∫</button>
            </div>
        </form>
    </div>


    <!-- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" -->
    <button id="show-devices-btn" class="btn btn-primary mb-4">–ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>

    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
    <button id="back-btn" class="btn btn-secondary mb-4" style="display: none;">–ù–∞–∑–∞–¥</button>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –±—Ä–µ–Ω–¥–æ–≤ -->
    <div id="device-buttons-container" style="display: none;">
        <div id="device-buttons" class="mb-4"></div>
        <div id="brand-buttons" class="mb-4"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø—á–∞—Å—Ç–µ–π -->
    <div id="parts-table-container" class="table-responsive">
        <table id="parts-table" class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th onclick="sortTable(0)">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
                    <th onclick="sortTable(1)">–ë—Ä–µ–Ω–¥</th>
                    <th onclick="sortTable(2)">–ú–æ–¥–µ–ª—å</th>
                    <th onclick="sortTable(3)">–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</th>
                    <th onclick="sortTable(4)">–¶–≤–µ—Ç</th>
                    <th onclick="sortTable(5)">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th onclick="sortTable(6)">–¶–µ–Ω–∞</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for part in parts %}
                <tr>
                    <td>{{ part.device }}</td>
                    <td>{{ part.brand }}</td>
                    <td>{{ part.model }}</td>
                    <td>{{ part.part_type }}</td>
                    <td>{{ part.color|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</td>
                    <td>{{ part.quantity }}</td>
                    <td>{{ part.price }}</td>
                    <td>
                        {% if part.image %}
                            <a href="{{ part.image.url }}" target="_blank" class="img-link">
                                <img src="{{ part.image.url }}" alt="{{ part.model }}" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">
                            </a>
                        {% else %}
                            –ù–µ—Ç —Ñ–æ—Ç–æ
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'edit_part' part.id %}" class="btn btn-sm btn-warning mb-1" data-toggle="tooltip" data-placement="top" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <a href="{% url 'delete_part' part.id %}" class="btn btn-sm btn-danger" data-toggle="tooltip" data-placement="top" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9" class="text-center">–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <script>
// –°–≤—è–∑—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –±—Ä–µ–Ω–¥–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏
const deviceBrandModelMap = {
    '–¢–µ–ª–µ—Ñ–æ–Ω': {
        'Samsung': ['a10', 'a20', 'a30', 's10'],
        'Huawei': ['p10', 'p20', 'honor 50'],
        'Xiaomi': ['redmi 5', 'redmi 6', 'redmi 7'],
        'Realme': ['realme 8', 'realme 6', 'realme 7', 'realme x2'],
        'LG': ['LG G7', 'LG V40', 'LG K50']
    },
    '–ü–ª–∞–Ω—à–µ—Ç': {
        'Samsung': ['tab s3', 'tab s4', 'tab a'],
        'Huawei': ['mediapad t5', 'mediapad m5'],
        'Xiaomi': ['mi pad 4', 'mi pad 5'],
        'Apple': ['iPad Air', 'iPad Pro', 'iPad Mini']
    },
    '–ù–æ—É—Ç–±—É–∫': {
        'Lenovo': ['thinkpad x1', 'ideapad 320'],
        'Asus': ['zenbook 14', 'vivobook s14'],
        'Acer': ['aspire 5', 'nitro 5']
    },
    '–°–º–∞—Ä—Ç-—á–∞—Å—ã': {
        'Samsung': ['galaxy watch', 'galaxy fit'],
        'Huawei': ['watch gt', 'watch fit'],
        'Xiaomi': ['mi band 4', 'mi band 5']
    }
};

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
let activeDeviceButton = null;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
document.getElementById('show-devices-btn').addEventListener('click', function() {
    const tableContainer = document.getElementById('parts-table-container');
    const deviceButtonsContainer = document.getElementById('device-buttons-container');
    const deviceButtonsDiv = document.getElementById('device-buttons');
    const backButton = document.getElementById('back-btn');

    if (tableContainer.style.display === 'none') {
        tableContainer.style.display = '';
        deviceButtonsContainer.style.display = 'none';
        backButton.style.display = 'none';
    } else {
        tableContainer.style.display = 'none';
        deviceButtonsContainer.style.display = 'block';
        backButton.style.display = 'block';

        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        deviceButtonsDiv.innerHTML = '';

        // –ú–∞—Å—Å–∏–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—É—Ç—è–º–∏ –∫ –∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
        const devices = {
            '–¢–µ–ª–µ—Ñ–æ–Ω': "{% static 'images/phone.jpg' %}",
            '–ü–ª–∞–Ω—à–µ—Ç': "{% static 'images/tablet.jpeg' %}",
            '–ù–æ—É—Ç–±—É–∫': "{% static 'images/laptop.png' %}",
            '–°–º–∞—Ä—Ç-—á–∞—Å—ã': "{% static 'images/smartwatch.png' %}"
        };

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
        for (let device in devices) {
            const button = document.createElement('button');
            button.classList.add('btn', 'btn-outline-primary', 'mr-2', 'mb-2');
            button.innerHTML = `<img src="${devices[device]}" alt="${device}" style="max-width: 50px; max-height: 50px;" class="mr-2">${device}`;
            button.onclick = () => {
                // –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
                if (activeDeviceButton) {
                    activeDeviceButton.classList.remove('btn-primary');
                    activeDeviceButton.classList.add('btn-outline-primary');
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–Ω–æ–ø–∫—É –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—É—é
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-primary');
                activeDeviceButton = button;

                // –ü–æ–∫–∞–∑–∞—Ç—å –±—Ä–µ–Ω–¥—ã
                showBrands(device);
            };
            deviceButtonsDiv.appendChild(button);
        }
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤
function showBrands(device) {
    const brandButtonsDiv = document.getElementById('brand-buttons');
    brandButtonsDiv.innerHTML = '';

    const brands = deviceBrandModelMap[device];

    for (let brand in brands) {
        const button = document.createElement('button');
        button.classList.add('btn', 'btn-outline-secondary', 'mr-2', 'mb-2');
        button.textContent = brand;
        button.onclick = () => showParts(device, brand);
        brandButtonsDiv.appendChild(button);
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø—á–∞—Å—Ç–µ–π
function showParts(device, brand) {
    const table = document.getElementById('parts-table');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    for (let row of rows) {
        const deviceCell = row.cells[0];
        const brandCell = row.cells[1];

        if (deviceCell.textContent === device && brandCell.textContent === brand) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    }

    document.getElementById('device-buttons-container').style.display = 'none';
    document.getElementById('parts-table-container').style.display = '';
}

// –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫—Ä–∞–Ω
document.getElementById('back-btn').addEventListener('click', function() {
    const tableContainer = document.getElementById('parts-table-container');
    const deviceButtonsContainer = document.getElementById('device-buttons-container');
    const backButton = document.getElementById('back-btn');

    if (deviceButtonsContainer.style.display === 'none') {
        deviceButtonsContainer.style.display = 'block';
        tableContainer.style.display = 'none';
        backButton.style.display = 'block';
    } else {
        deviceButtonsContainer.style.display = 'none';
        tableContainer.style.display = 'block';
        backButton.style.display = 'none';
    }
});
    </script>
{% endblock %}
