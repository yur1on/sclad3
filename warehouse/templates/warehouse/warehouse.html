{% extends 'warehouse/base.html' %}
{% block title %}–°–∫–ª–∞–¥{% endblock %}
{% block content %}
    <div class="d-flex flex-column align-items-start mb-4">
        <div class="d-flex justify-content-between align-items-center w-100 mb-4">
            <h2 class="mb-0">–í–∞—à–∏ –∑–∞–ø—á–∞—Å—Ç–∏</h2>
            <div class="d-flex">
                <a href="{% url 'add_part' %}" class="btn btn-success mr-2">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</a>
                <a href="{% url 'export_excel' %}" class="btn btn-info">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" -->
    <button id="show-devices-btn" class="btn btn-primary mb-4">–ü–æ–∫–∞–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –±—Ä–µ–Ω–¥–æ–≤ -->
    <div id="device-buttons-container" style="display: none;">
        <div id="device-buttons" class="mb-4"></div>
        <div id="brand-buttons" class="mb-4"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø—á–∞—Å—Ç–µ–π -->
    <div id="parts-table-container" class="table-responsive">
        <table id="parts-table" class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th onclick="sortTable(0)">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
                    <th onclick="sortTable(1)">–ë—Ä–µ–Ω–¥</th>
                    <th onclick="sortTable(2)">–ú–æ–¥–µ–ª—å</th>
                    <th onclick="sortTable(3)">–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</th>
                    <th onclick="sortTable(4)">–¶–≤–µ—Ç</th>
                    <th onclick="sortTable(5)">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th onclick="sortTable(6)">–¶–µ–Ω–∞</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for part in parts %}
                <tr>
                    <td>{{ part.device }}</td>
                    <td>{{ part.brand }}</td>
                    <td>{{ part.model }}</td>
                    <td>{{ part.part_type }}</td>
                    <td>{{ part.color|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</td>
                    <td>{{ part.quantity }}</td>
                    <td>{{ part.price }}</td>
                    <td>
                        {% if part.image %}
                            <a href="{{ part.image.url }}" target="_blank" class="img-link">
                                <img src="{{ part.image.url }}" alt="{{ part.model }}" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">
                            </a>
                        {% else %}
                            –ù–µ—Ç —Ñ–æ—Ç–æ
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'edit_part' part.id %}" class="btn btn-sm btn-warning mb-1" data-toggle="tooltip" data-placement="top" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <a href="{% url 'delete_part' part.id %}" class="btn btn-sm btn-danger" data-toggle="tooltip" data-placement="top" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9" class="text-center">–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
// –°–≤—è–∑—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –±—Ä–µ–Ω–¥–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏
const deviceBrandModelMap = {
    '–¢–µ–ª–µ—Ñ–æ–Ω': {
        'Samsung': ['a10', 'a20', 'a30', 's10'],
        'Huawei': ['p10', 'p20', 'honor 50'],
        'Xiaomi': ['redmi 5', 'redmi 6', 'redmi 7'],
        // –î–æ–±–∞–≤–ª—è–µ–º –±—Ä–µ–Ω–¥ Realme —Å –µ–≥–æ –º–æ–¥–µ–ª—è–º–∏
        'Realme': ['realme 8', 'realme 6', 'realme 7', 'realme x2'],
        'LG': ['LG G7', 'LG V40', 'LG K50']

    },
    '–ü–ª–∞–Ω—à–µ—Ç': {
        'Samsung': ['tab s3', 'tab s4', 'tab a'],
        'Huawei': ['mediapad t5', 'mediapad m5'],
        'Xiaomi': ['mi pad 4', 'mi pad 5'],
        'Apple': ['iPad Air', 'iPad Pro', 'iPad Mini']
    },
    '–ù–æ—É—Ç–±—É–∫': {
        'Lenovo': ['thinkpad x1', 'ideapad 320'],
        'Asus': ['zenbook 14', 'vivobook s14'],
        'Acer': ['aspire 5', 'nitro 5']
    },
    '–°–º–∞—Ä—Ç-—á–∞—Å—ã': {
        'Samsung': ['galaxy watch', 'galaxy fit'],
        'Huawei': ['watch gt', 'watch fit'],
        'Xiaomi': ['mi band 4', 'mi band 5']
    }
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
document.getElementById('show-devices-btn').addEventListener('click', function() {
    const tableContainer = document.getElementById('parts-table-container');
    const deviceButtonsContainer = document.getElementById('device-buttons-container');
    const deviceButtonsDiv = document.getElementById('device-buttons');

    if (tableContainer.style.display === 'none') {
        tableContainer.style.display = '';
        deviceButtonsContainer.style.display = 'none';
    } else {
        tableContainer.style.display = 'none';
        deviceButtonsContainer.style.display = 'block';

        // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        deviceButtonsDiv.innerHTML = '';

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        Object.keys(deviceBrandModelMap).forEach(device => {
            const button = document.createElement('button');
            button.className = 'btn btn-info mr-2 mb-2';
            button.textContent = device;
            button.onclick = function() {
                showBrands(device);
            };
            deviceButtonsDiv.appendChild(button);
        });
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
function showBrands(device) {
    const brandButtonsDiv = document.getElementById('brand-buttons');
    brandButtonsDiv.innerHTML = '';

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±—Ä–µ–Ω–¥–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    if (deviceBrandModelMap[device]) {
        Object.keys(deviceBrandModelMap[device]).forEach(brand => {
            const button = document.createElement('button');
            button.className = 'btn btn-secondary mr-2 mb-2';
            button.textContent = brand;
            button.onclick = function() {
                showPartsTable(device, brand);
            };
            brandButtonsDiv.appendChild(button);
        });
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞
function showPartsTable(device, brand) {
    const tableRows = document.querySelectorAll('#parts-table tbody tr');

    tableRows.forEach(row => {
        const deviceCell = row.cells[0].textContent.trim();
        const brandCell = row.cells[1].textContent.trim();

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –∏ –±—Ä–µ–Ω–¥—É
        if (deviceCell === device && brandCell === brand) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });

    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –±—Ä–µ–Ω–¥–∞
    document.getElementById('device-buttons-container').style.display = 'none';
    document.getElementById('parts-table-container').style.display = 'block';
}

    </script>
{% endblock %}
