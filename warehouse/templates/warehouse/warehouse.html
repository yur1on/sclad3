{% extends 'warehouse/base.html' %}
{% block title %}–ú–æ–π —Å–∫–ª–∞–¥{% endblock %}
{% block content %}
{% load static %}
<div class="container my-4">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">–í–∞—à–∏ –∑–∞–ø—á–∞—Å—Ç–∏</h2>
        <div>
            <a href="{% url 'add_part' %}" class="btn btn-success me-2">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç—å</a>
            <a href="{% url 'export_excel' %}" class="btn btn-info me-2">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
            <a href="{% url 'import_parts' %}" class="btn btn-warning">–ò–º–ø–æ—Ä—Ç Excel</a>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <div class="mb-4">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label for="device" class="form-label">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label>
                <input type="text" list="devices" name="q" id="device" class="form-control" placeholder="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" value="{{ query|default_if_none:'' }}">
                <datalist id="devices">
                    <option value="–¢–µ–ª–µ—Ñ–æ–Ω">
                    <option value="–ü–ª–∞–Ω—à–µ—Ç">
                    <option value="–ù–æ—É—Ç–±—É–∫">
                    <option value="–°–º–∞—Ä—Ç-—á–∞—Å—ã">
                </datalist>
            </div>

            <div class="col-md-2">
                <label for="brand" class="form-label">–ë—Ä–µ–Ω–¥</label>
                <input list="brands" name="brand" id="brand" class="form-control" placeholder="–ë—Ä–µ–Ω–¥" value="{{ brand|default_if_none:'' }}">
                <datalist id="brands"></datalist>
            </div>

            <div class="col-md-2">
                <label for="model" class="form-label">–ú–æ–¥–µ–ª—å</label>
                <input list="models" name="model" id="model" class="form-control" placeholder="–ú–æ–¥–µ–ª—å" value="{{ model|default_if_none:'' }}">
                <datalist id="models"></datalist>
            </div>

            <div class="col-md-3">
                <label for="part_type" class="form-label">–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</label>
                <input list="part_types" name="part_type" id="part_type" class="form-control" placeholder="–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏" value="{{ part_type|default_if_none:'' }}">
                <datalist id="part_types"></datalist>
            </div>

            <div class="col-md-2 d-grid align-items-end">
                <button type="submit" class="btn btn-primary">–ü–æ–∏—Å–∫</button>
            </div>
        </form>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ -->
    <div id="device-buttons-container" class="mb-4">
        <h4 class="small-header">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h4>
        <div id="device-buttons" class="mb-3">
            {% for device in devices %}
                <button class="btn btn-outline-primary btn-compact" onclick="filterByDevice('{{ device }}')">{{ device }}</button>
            {% endfor %}
        </div>
    </div>

    <div id="brand-buttons-container" class="mb-4" style="display: none;">
        <h4 class="small-header">–ë—Ä–µ–Ω–¥</h4>
        <div id="brand-buttons" class="mb-3">
            {% for brand in brands %}
                <button class="btn btn-outline-secondary btn-compact" onclick="filterByBrand('{{ brand }}')">{{ brand }}</button>
            {% endfor %}
        </div>
    </div>

    <div id="model-buttons-container" class="mb-4" style="display: none;">
        <h4 class="small-header">–ú–æ–¥–µ–ª—å</h4>
        <div id="model-buttons" class="mb-3"></div>
    </div>

    <div id="part-type-buttons-container" class="mb-4" style="display: none;">
        <h4 class="small-header">–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</h4>
        <div id="part-type-buttons" class="mb-3"></div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø—á–∞—Å—Ç–µ–π -->
    <div id="parts-table-container" class="table-responsive">
        <table id="parts-table" class="table table-striped table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
                    <th>–ë—Ä–µ–Ω–¥</th>
                    <th>–ú–æ–¥–µ–ª—å</th>
                    <th>–¢–∏–ø –∑–∞–ø—á–∞—Å—Ç–∏</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="parts-table-body">
                {% for part in page_obj %}
                <tr>
                    <td>{{ part.device }}</td>
                    <td>{{ part.brand }}</td>
                    <td>{{ part.model }}</td>
                    <td>{{ part.part_type }}</td>
                    <td>
                        <div>
                            <strong>–¶–≤–µ—Ç:</strong> {{ part.color|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }},
                            <strong>–¶–µ–Ω–∞:</strong> {{ part.price }},
                            <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> {{ part.quantity }}
                        </div>
                        <div>
                            {% if part.condition %}
                                <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> {{ part.condition }}
                            {% endif %}
                            {% if part.note %}
                                <strong>, –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong>{{ part.note }}
                            {% else %}
                                <strong>, –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong><span> –ù–µ—Ç –ø—Ä–∏–º–µ—á–∞–Ω–∏–π</span>
                            {% endif %}

                        </div>
                    </td>
                    <td>
                        {% if part.images.all %}
                        <div class="d-flex">
                            {% for image in part.images.all %}
                            <a href="{{ image.image.url }}" target="_blank" class="img-link">
                                <img src="{{ image.image.url }}" alt="{{ part.model }}" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
                            </a>
                            {% endfor %}
                        </div>
                        {% else %}
                        –ù–µ—Ç —Ñ–æ—Ç–æ
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'edit_part' part.id %}" class="btn btn-warning btn-sm mb-1" data-bs-toggle="tooltip" data-bs-placement="top" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <a href="{% url 'delete_part' part.id %}" class="btn btn-danger btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center">–ó–∞–ø—á–∞—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1" aria-label="First">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&lsaquo;</span>
                    </a>
                </li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&rsaquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<script src="{% static 'js/warehouse.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/warehouse.css' %}">
{% endblock %}
