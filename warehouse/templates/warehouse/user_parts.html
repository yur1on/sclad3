{% extends 'warehouse/base.html' %}

{% block title %}Запчасти пользователя {{ viewed_user_full_name }}{% endblock %}

{% block content %}
<div class="up-wrap">
  <header class="up-header">
    <div class="up-title">
      <h2>Запчасти пользователя</h2>
      <div class="up-subtitle">{{ viewed_user_full_name }}</div>
    </div>

    <form method="get" action="{% url 'search_user_parts' viewed_user.id %}" class="up-search" role="search">
      <div class="up-search-group">
        <input
          type="text"
          name="query"
          class="up-input"
          placeholder="Поиск по модели или типу…"
          value="{{ request.GET.query }}"
          autocomplete="off"
        >
        <button type="submit" class="up-btn">Найти</button>
      </div>
    </form>
  </header>

  {% if grouped_parts %}
    {% for device, brands in grouped_parts.items %}
      <section class="up-section">
        <div class="up-section-head">
          <h3 class="up-h3">{{ device }}</h3>
        </div>

        {% for brand, parts in brands.items %}
          <div class="up-card">
            <div class="up-card-head">
              <h4 class="up-h4">{{ brand }}</h4>
              <span class="up-pill">В наличии</span>
            </div>

            <div class="up-table-wrap">
              <table class="up-table">
                <thead>
                  <tr>
                    <th>Модель</th>
                    <th>Тип</th>
                    <th class="col-muted hide-sm">Цвет</th>
                    <th class="col-num hide-sm">Кол-во</th>
                    <th class="col-num hide-sm">Цена</th>
                    <th class="col-action">Детали</th>
                  </tr>
                </thead>
                <tbody>
                  {% for part in parts %}
                    {% if part.quantity > 0 %}
                      <tr>
                        <td class="cell-strong">{{ part.display_model }}</td>
                        <td>{{ part.part_type }}</td>
                        <td class="col-muted hide-sm">{{ part.color|default:"—" }}</td>
                        <td class="col-num hide-sm">{{ part.quantity }}</td>
                        <td class="col-num hide-sm">{{ part.price }}</td>
                        <td class="col-action">
                          <a href="{% url 'part_detail' part.id %}" class="up-linkbtn" aria-label="Подробнее">
                            <span class="up-linkbtn-ico" aria-hidden="true">⌁</span>
                            <span class="up-linkbtn-text">Подробнее</span>
                          </a>
                        </td>
                      </tr>
                    {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endfor %}
      </section>
    {% endfor %}
  {% else %}
    <div class="up-empty">
      <div class="up-empty-title">Ничего не найдено</div>
      <div class="up-empty-text">Попробуй изменить запрос поиска.</div>
    </div>
  {% endif %}
</div>

<style>
  :root{
    --bg: #ffffff;
    --text: #0f172a;
    --muted: #64748b;
    --line: #e5e7eb;
    --soft: #f8fafc;
    --soft2:#f1f5f9;
    --accent:#2563eb;
    --accent2:#1d4ed8;
    --radius: 14px;
  }

  /* контейнер */
  .up-wrap{
    max-width: 1100px;
    margin: 18px auto 48px;
    padding: 0 14px;
    color: var(--text);
  }

  /* шапка */
  .up-header{
    position: sticky;
    top: 10px;
    z-index: 2;
    background: rgba(255,255,255,.86);
    backdrop-filter: blur(10px);
    border: 1px solid var(--line);
    border-radius: var(--radius);
    padding: 14px 14px;
    display: flex;
    align-items: center;
    gap: 14px;
    justify-content: space-between;
    box-shadow: 0 6px 18px rgba(15, 23, 42, .06);
  }

  .up-title h2{
    margin: 0;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.02em;
  }
  .up-subtitle{
    margin-top: 2px;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.2;
  }

  /* поиск */
  .up-search{ margin: 0; }
  .up-search-group{
    display: flex;
    align-items: stretch;
    gap: 8px;
  }
  .up-input{
    width: min(420px, 60vw);
    border: 1px solid var(--line);
    background: var(--bg);
    border-radius: 12px;
    padding: 10px 12px;
    font-size: 14px;
    outline: none;
    transition: border-color .15s ease, box-shadow .15s ease;
  }
  .up-input:focus{
    border-color: rgba(37,99,235,.45);
    box-shadow: 0 0 0 4px rgba(37,99,235,.12);
  }
  .up-btn{
    border: 1px solid rgba(37,99,235,.25);
    background: var(--accent);
    color: #fff;
    font-weight: 600;
    font-size: 14px;
    padding: 10px 14px;
    border-radius: 12px;
    cursor: pointer;
    transition: transform .06s ease, background .15s ease;
  }
  .up-btn:hover{ background: var(--accent2); }
  .up-btn:active{ transform: translateY(1px); }

  /* секции */
  .up-section{ margin-top: 14px; }
  .up-section-head{
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    margin: 18px 4px 10px;
  }
  .up-h3{
    margin: 0;
    font-size: 15px;
    font-weight: 800;
    letter-spacing: -0.01em;
  }

  /* карточка бренда — минимальная, без "объема" */
  .up-card{
    border: 1px solid var(--line);
    border-radius: var(--radius);
    background: var(--bg);
    overflow: hidden;
    margin-bottom: 12px;
  }
  .up-card-head{
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: linear-gradient(0deg, var(--bg), var(--soft));
    border-bottom: 1px solid var(--line);
  }
  .up-h4{
    margin: 0;
    font-size: 14px;
    font-weight: 700;
  }
  .up-pill{
    font-size: 12px;
    color: var(--muted);
    background: var(--soft2);
    border: 1px solid var(--line);
    padding: 4px 8px;
    border-radius: 999px;
  }

  /* таблица */
  .up-table-wrap{ overflow-x: auto; }
  .up-table{
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 14px;
  }
  .up-table thead th{
    text-align: left;
    font-size: 12px;
    color: var(--muted);
    font-weight: 700;
    padding: 10px 12px;
    background: var(--soft);
    border-bottom: 1px solid var(--line);
    white-space: nowrap;
  }
  .up-table tbody td{
    padding: 10px 12px;
    border-bottom: 1px solid var(--line);
    vertical-align: middle;
  }
  .up-table tbody tr:hover td{
    background: rgba(241,245,249,.65);
  }
  .up-table tbody tr:last-child td{ border-bottom: 0; }

  .cell-strong{ font-weight: 650; }
  .col-muted{ color: var(--muted); }
  .col-num{ text-align: right; }
  .col-action{ width: 120px; text-align: right; }

  /* кнопка "Подробнее" — тонкая, современная */
  .up-linkbtn{
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 7px 10px;
    border-radius: 12px;
    border: 1px solid var(--line);
    background: #fff;
    color: var(--text);
    text-decoration: none;
    font-weight: 600;
    font-size: 13px;
    transition: border-color .15s ease, box-shadow .15s ease, transform .06s ease;
  }
  .up-linkbtn:hover{
    border-color: rgba(37,99,235,.35);
    box-shadow: 0 0 0 4px rgba(37,99,235,.10);
  }
  .up-linkbtn:active{ transform: translateY(1px); }
  .up-linkbtn-ico{
    width: 22px;
    height: 22px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    background: var(--soft2);
    color: var(--muted);
    font-weight: 800;
    line-height: 1;
  }

  /* пустое состояние */
  .up-empty{
    margin-top: 16px;
    border: 1px dashed var(--line);
    border-radius: var(--radius);
    padding: 18px 14px;
    background: var(--soft);
    text-align: center;
  }
  .up-empty-title{
    font-weight: 800;
    letter-spacing: -0.01em;
  }
  .up-empty-text{
    margin-top: 4px;
    color: var(--muted);
    font-size: 14px;
  }

  /* адаптив */
  @media (max-width: 576px){
    .up-header{
      position: static; /* чтобы не занимал место липким блоком на очень маленьких */
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
    }
    .up-input{ width: 100%; }
    .hide-sm{ display: none; }
    .col-action{ width: 88px; }
    .up-linkbtn-text{ display: none; }
  }
</style>
{% endblock %}
