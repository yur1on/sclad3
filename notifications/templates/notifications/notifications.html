{% extends "warehouse/base.html" %}

{% block title %}Уведомления{% endblock %}

{% block content %}
<div class="container">
    <h2 class="my-4">Уведомления</h2>

    {% if notifications %}
        <ul class="list-group">
            {% for notification in notifications %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ notification.message }}
                    <button class="btn btn-sm btn-danger mark-as-read" data-id="{{ notification.id }}">Удалить</button>
                </li>
            {% endfor %}
        </ul>

        <form method="POST" action="{% url 'clear_notifications' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-dark mt-3">Очистить все уведомления</button>
        </form>
    {% else %}
        <p class="text-muted">Нет новых уведомлений.</p>
    {% endif %}
</div>

<script>
document.querySelectorAll(".mark-as-read").forEach(button => {
    button.addEventListener("click", function() {
        let notificationId = this.getAttribute("data-id");

        fetch(`/notifications/read/${notificationId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json"
            }
        }).then(response => response.json()).then(data => {
            if (data.success) {
                this.parentElement.remove();
            }
        });
    });
});
</script>
{% endblock %}
