{% extends 'warehouse/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5 mb-5 d-flex justify-content-center align-items-center">
    <!-- Форма в центре -->
    <div class="card shadow-lg p-4">
        <h4 class="text-center mb-4">Оставить отзыв</h4>
        <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}

            <!-- Блок с рейтингом -->
            <div class="form-group mb-4">
                <label for="rating" class="form-label">Ваша оценка:</label>
                <div class="rating-container d-flex justify-content-between mt-2">
                    {% for i in "12345" %}
                        <span
                            class="rating-star"
                            data-value="{{ i }}"
                            style="cursor: pointer; color: #ddd; transition: all 0.3s ease;">
                            ★
                        </span>
                    {% endfor %}
                </div>
                <input type="hidden" name="rating" id="rating-input" value="{{ form.rating.value|default:'5' }}">
            </div>

            <!-- Поле комментария -->
            <div class="form-group mb-4">
                <label for="comment" class="form-label">Ваш комментарий:</label>
                <textarea
                    id="id_comment"
                    name="comment"
                    class="form-control border shadow-sm"
                    placeholder="Введите ваш комментарий..."
                    style="border: 2px solid #add8e6;">{{ form.comment.value|default_if_none:"" }}</textarea>
            </div>

            <!-- Кнопка отправки -->
            <button type="submit" class="btn btn-primary w-100 py-2">
                Отправить
            </button>
        </form>

        <!-- Ошибки формы -->
        {% if form.errors %}
            <div class="alert alert-danger mt-3">
                <ul class="mb-0">
                    {% for error in form.errors.values %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <!-- Кнопка назад -->
        <a href="javascript:history.back()" class="btn btn-link mt-3 text-center w-100">
           Назад
        </a>
    </div>
</div>

<style>
    /* Базовые стили для десктопа */
    .container {
        max-width: 1200px;
        min-height: calc(100vh - 200px); /* Учитываем высоту шапки и подвала */
        padding: 1rem;
    }

    .card {
        max-width: 400px;
        width: 100%;
        background-color: #fff;
        border-radius: 15px;
        padding: 1.5rem;
    }

    h4 {
        font-size: 1.5rem;
        font-weight: 600;
    }

    .form-label {
        font-weight: 500;
        font-size: 1rem;
    }

    .rating-star {
        font-size: 2rem;
    }

    .form-control {
        height: 100px;
        border-radius: 10px;
        font-size: 1rem;
        padding: 0.75rem;
    }

    .btn-primary {
        font-weight: 600;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
    }

    .alert {
        border-radius: 10px;
        padding: 1rem;
        font-size: 0.9rem;
    }

    .btn-link {
        text-decoration: none;
        color: #6c757d;
        font-weight: 500;
        font-size: 1rem;
        padding: 0.5rem 0;
    }

    /* Адаптивность для мобильных устройств (<576px) */
    @media (max-width: 576px) {
        .container {
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            padding: 0.5rem;
        }

        .card {
            padding: 1rem;
            border-radius: 10px;
            max-width: 100%;
            margin: 0 0.5rem;
        }

        h4 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            font-size: 0.9rem;
        }

        .rating-star {
            font-size: 1.5rem;
        }

        .form-control {
            height: 80px;
            font-size: 0.85rem;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .btn-primary {
            padding: 0.5rem;
            font-size: 0.9rem;
            border-radius: 8px;
        }

        .alert {
            font-size: 0.8rem;
            padding: 0.75rem;
            border-radius: 8px;
            margin: 0.75rem 0 0;
        }

        .btn-link {
            font-size: 0.9rem;
            padding: 0.25rem 0;
        }
    }
</style>

<!-- JavaScript для работы со звездами -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Устанавливаем 5 звезд по умолчанию, если рейтинг не задан
        let initialRating = document.getElementById('rating-input').value || 5;
        document.getElementById('rating-input').value = initialRating;

        // Отображаем начальный рейтинг
        document.querySelectorAll('.rating-star').forEach(star => {
            if (star.getAttribute('data-value') <= initialRating) {
                star.style.color = '#FFD700'; // Золотой цвет
                star.style.transform = 'scale(1.1)';
            } else {
                star.style.color = '#ddd'; // Серый цвет
                star.style.transform = 'scale(1)';
            }
        });

        // Обработка клика по звездам
        document.querySelectorAll('.rating-star').forEach(star => {
            star.addEventListener('click', function () {
                const ratingValue = this.getAttribute('data-value');
                document.getElementById('rating-input').value = ratingValue;

                // Обновляем стили для выделенных звезд
                document.querySelectorAll('.rating-star').forEach(star => {
                    if (star.getAttribute('data-value') <= ratingValue) {
                        star.style.color = '#FFD700'; // Золотой цвет
                        star.style.transform = 'scale(1.1)';
                    } else {
                        star.style.color = '#ddd'; // Серый цвет
                        star.style.transform = 'scale(1)';
                    }
                });
            });
        });
    });
</script>
{% endblock %}