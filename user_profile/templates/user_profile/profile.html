{% extends 'warehouse/base.html' %}
{% block title %}Профиль{% endblock %}
{% block content %}
{% load static %}
    <div class="card">
        <div class="card-header">
            <h2>Ваш профиль</h2>
        </div>
        <div class="card-body">
            {% if edit_mode %}
                <!-- Форма редактирования -->
                <form method="post" class="form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="phone">Телефон:</label>
                        {{ form.phone }}
                    </div>

                    <div class="form-group">
                        <label for="region">Область:</label>
                        <select id="id_region" name="region" class="form-control">
                            <option value="">Выберите область</option>
                            {% for region in form.region.field.choices %}
                                <option value="{{ region.0 }}">{{ region.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="city">Город:</label>
                        <select id="id_city" name="city" class="form-control">
                            <option value="">Выберите город</option>
                            <!-- Города будут подгружаться динамически -->
                        </select>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-success">Сохранить изменения</button>
                        <a href="{% url 'profile' %}" class="btn btn-secondary">Отменить</a>
                    </div>
                </form>

            {% else %}
                <table class="table table-bordered">
                    <tr>
                        <th>Имя пользователя</th>
                        <td>{{ user.username }}</td>
                    </tr>
                    <tr>
                        <th>Телефон</th>
                        <td>{{ user.profile.phone }}</td>
                    </tr>
                    <tr>
                        <th>Город</th>
                        <td>{{ user.profile.city }}</td>
                    </tr>
                    <tr>
                        <th>Рейтинг</th>
                        <td>
                            {% if user.profile.average_rating %}
                                {{ user.profile.average_rating|floatformat:1 }} / 5 ({{ user.profile.received_reviews.count }} отзывов)
                            {% else %}
                                0 / 5 (0 отзывов)
                            {% endif %}
                        </td>
                    </tr>
                </table>

                <a href="?edit=true" class="btn btn-primary">Редактировать профиль</a>

                <h3>Отзывы пользователей</h3>
                {% for review in reviews %}
                    <div class="review card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Рейтинг: {{ review.rating }} / 5</h5>
                            <p class="card-text">Комментарий: {{ review.comment }}</p>
                            <p class="card-text"><small class="text-muted">Оставил: {{ review.reviewer.username }}</small></p>
                            <p class="card-text"><small class="text-muted">Дата: {{ review.created_at|date:"d M Y" }}</small></p>
                        </div>
                    </div>
                {% empty %}
                    <p>Нет отзывов</p>
                {% endfor %}
            {% endif %}
        </div>
    </div>

<script src="{% static 'js/profile.js' %}"></script> <!-- Ссылка на ваш JS файл -->
{% endblock %}
